import{s as L,n as F,o as R}from"../chunks/scheduler.f9c04a13.js";import{S as D,i as G,m,g as w,s as S,n as v,h as g,j as b,y as x,c as T,f as u,k as A,a as I,x as p,z,o as U}from"../chunks/index.4554b1e8.js";function W(d){let e,t="Login with OpenID Connect",s,a;return{c(){e=w("button"),e.textContent=t,this.h()},l(i){e=g(i,"BUTTON",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-15fwta7"&&(e.textContent=t),this.h()},h(){A(e,"class","svelte-p1csvu")},m(i,h){I(i,e,h),s||(a=z(e,"click",j),s=!0)},p:F,d(i){i&&u(e),s=!1,a()}}}function X(d){let e,t,s,a=(d[1].name||"User")+"",i,h,l,c,o=d[1].email+"",n,y,_,C,k;return{c(){e=w("div"),t=w("h2"),s=m("Welcome, "),i=m(a),h=S(),l=w("p"),c=m("Email: "),n=m(o),y=S(),_=w("p"),C=m("Access Token: "),k=m(d[0])},l(r){e=g(r,"DIV",{});var f=b(e);t=g(f,"H2",{});var O=b(t);s=v(O,"Welcome, "),i=v(O,a),O.forEach(u),h=T(f),l=g(f,"P",{});var P=b(l);c=v(P,"Email: "),n=v(P,o),P.forEach(u),y=T(f),_=g(f,"P",{});var E=b(_);C=v(E,"Access Token: "),k=v(E,d[0]),E.forEach(u),f.forEach(u)},m(r,f){I(r,e,f),p(e,t),p(t,s),p(t,i),p(e,h),p(e,l),p(l,c),p(l,n),p(e,y),p(e,_),p(_,C),p(_,k)},p(r,f){f&2&&a!==(a=(r[1].name||"User")+"")&&U(i,a),f&2&&o!==(o=r[1].email+"")&&U(n,o),f&1&&U(k,r[0])},d(r){r&&u(e)}}}function Z(d){let e,t,s,a="OIDC Flow with Svelte",i;function h(o,n){return o[0]?X:W}let l=h(d),c=l(d);return{c(){e=m(`// src/App.svelte





`),t=w("div"),s=w("h1"),s.textContent=a,i=S(),c.c(),this.h()},l(o){e=v(o,`// src/App.svelte





`),t=g(o,"DIV",{class:!0});var n=b(t);s=g(n,"H1",{"data-svelte-h":!0}),x(s)!=="svelte-x70the"&&(s.textContent=a),i=T(n),c.l(n),n.forEach(u),this.h()},h(){A(t,"class","container svelte-p1csvu")},m(o,n){I(o,e,n),I(o,t,n),p(t,s),p(t,i),c.m(t,null)},p(o,[n]){l===(l=h(o))&&c?c.p(o,n):(c.d(1),c=l(o),c&&(c.c(),c.m(t,null)))},i:F,o:F,d(o){o&&(u(e),u(t)),c.d()}}}const q="https://sso.melo.se/application/o/emqx/.well-known/openid-configuration";async function $(){return await(await fetch(q)).json()}function j(){$().then(d=>{const e="pPdjbX7XGaFpwme0AlZCPbkJ5ZFF4lGYRWOeLIy8",t=window.location.href.split("?")[0],s="openid profile email",a="code",i=Math.random().toString(36).substring(7),h=`${d.authorization_endpoint}?response_type=${a}&client_id=${e}&redirect_uri=${t}&scope=${s}&state=${i}`;window.location.href=h})}function B(d,e,t){let s="",a={};async function i(){const l=new URLSearchParams(window.location.search),c=l.get("code"),o=l.get("state");c&&o&&$().then(n=>{const y="pPdjbX7XGaFpwme0AlZCPbkJ5ZFF4lGYRWOeLIy8",_=window.location.href.split("?")[0],C=n.token_endpoint,k=new URLSearchParams({grant_type:"authorization_code",code:c,redirect_uri:_,client_id:y});fetch(C,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:k.toString()}).then(r=>r.json()).then(r=>{r.access_token&&(t(0,s=r.access_token),h(s))}).catch(r=>console.error("Error exchanging code for tokens",r))})}function h(l){$().then(c=>{const o=c.userinfo_endpoint;fetch(o,{method:"POST",headers:{Authorization:`Bearer ${l}`}}).then(n=>n.json()).then(n=>{console.log(n),t(1,a=n)}).catch(n=>console.error("Error fetching user info",n))})}return R(()=>{window.location.search.includes("code=")?i():j()}),[s,a]}class M extends D{constructor(e){super(),G(this,e,B,Z,L,{})}}export{M as component};
